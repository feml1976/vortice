# Configuración para tests con Testcontainers PostgreSQL
spring:
  datasource:
    # Las propiedades de conexión se configuran dinámicamente por Testcontainers
    # a través de @DynamicPropertySource en BaseRepositoryTest
    driver-class-name: org.postgresql.Driver

  jpa:
    hibernate:
      # validate: no cambiar el esquema, solo validar contra las migraciones de Flyway
      ddl-auto: validate
    properties:
      hibernate:
        dialect: org.hibernate.dialect.PostgreSQLDialect
        format_sql: true
    show-sql: false

  flyway:
    # Habilitar Flyway para ejecutar migraciones en tests
    enabled: true
    # Limpiar el esquema antes de ejecutar migraciones (útil para tests)
    clean-disabled: false
    clean-on-validation-error: true
    baseline-on-migrate: true

  # Configuración de SQL para limpiar datos entre tests
  sql:
    init:
      mode: never # No usar scripts de inicialización de Spring, usar solo Flyway

# Rate limiting configurado para tests (límites bajos para facilitar testing)
vortice:
  jwt:
    secret: test-secret-key-for-testing-purposes-only
    expiration: 3600000
    refresh-expiration: 7200000

  rate-limit:
    enabled: true
    global:
      capacity: 100
      refill-tokens: 100
      refill-period-minutes: 1
    auth:
      capacity: 5
      refill-tokens: 5
      refill-period-minutes: 1
    register:
      capacity: 3
      refill-tokens: 3
      refill-period-minutes: 1
